# ุฎุทุฉ ุฅุตูุงุญ: ูุตู ุงููุฎุฒู ุนู ุงูุตุงูุงุช

**ุงูุชุงุฑูุฎ:** 2025-10-09  
**ุงูุฃููููุฉ:** ุนุงููุฉ ๐ด

## ุงููุดููุฉ ุงูุญุงููุฉ

### 1. ุฎุทุฃ `showroom_id = None` ุนูุฏ ุฅุถุงูุฉ ููุฑุฏ
```
NOT NULL constraint failed: suppliers.showroom_id
```
**ุงูุณุจุจ:** ุฏุงูุฉ `get_user_showroom_id()` ุชุฑุฌุน `None` ูููุฏูุฑ ุนูุฏูุง ูุง ูููู ููุชุฑ ุงูุตุงูุฉ ููุนูู.

**ุงูุญู:** โ ุชู ุงูุฅุตูุงุญ - ุฅุถุงูุฉ fallback ูุฃูู ุตุงูุฉ ูุดุทุฉ.

---

### 2. ุงููุฎุฒู ูุฑุชุจุท ุจุงูุตุงูุฉ (ุฎุทุฃ ููุทูู)
**ุงููุดููุฉ:**
- ุฌุฏูู `Material` ูุญุชูู ุนูู `showroom_id`
- ูุฐุง ูุนูู ูู ุตุงูุฉ ููุง ูุฎุฒู ูููุตู
- **ุงูููุทู ุงูุตุญูุญ:** ุงููุฎุฒู ูุงุญุฏ ูุดุชุฑู ุจูู ุฌููุน ุงูุตุงูุงุช

**ุงูุชุฃุซูุฑ:**
- ุชูุฑุงุฑ ุบูุฑ ุถุฑูุฑู ููููุงุฏ
- ุตุนูุจุฉ ูู ุฅุฏุงุฑุฉ ุงููุฎุฒู ุงูููุญุฏ
- ุชุนููุฏ ูู ุชุชุจุน ุงููููุงุช ุงูุฅุฌูุงููุฉ

---

## ุงูุญู ุงูููุชุฑุญ

### ุงูุฎูุงุฑ 1: ุฅุฒุงูุฉ `showroom_id` ูู `Material` ุชูุงูุงู โ (ููุตู ุจู)

**ุงูููุทู:**
- ุงููุฎุฒู ูุงุญุฏ ูููุตูุน ููู
- ุฌููุน ุงูุตุงูุงุช ุชุณุญุจ ูู ููุณ ุงููุฎุฒู
- ุงูููุฑุฏูู ูุถูููู ุฅูู ุงููุฎุฒู ุงูููุญุฏ
- ููุงุชูุฑ ุงูุดุฑุงุก ูุฑุชุจุทุฉ ุจุงูุตุงูุฉ (ูู ุฃุถุงููุง)ุ ููู ุงูููุงุฏ ุชุฐูุจ ูููุฎุฒู ุงูููุญุฏ

**ุงูุชุบููุฑุงุช ุงููุทููุจุฉ:**

1. **ุชุนุฏูู ูููุฐุฌ `Material`:**
   - ุญุฐู `showroom_id`
   - ุญุฐู `showroom` relationship
   - ุฅุถุงูุฉ ุญูู `warehouse_location` (ุงุฎุชูุงุฑู)

2. **ุชุนุฏูู ูููุฐุฌ `Showroom`:**
   - ุญุฐู `materials` relationship

3. **Migration Script:**
   - ุญุฐู ุนููุฏ `showroom_id` ูู ุฌุฏูู `material`
   - ููู ุงูุจูุงูุงุช ุงูููุฑุฑุฉ (ุฏูุฌ ุงูููุงุฏ ุงููุชุดุงุจูุฉ)

4. **ุชุญุฏูุซ ุงููุณุงุฑุงุช:**
   - `/materials`: ุฅุฒุงูุฉ ููุชุฑ ุงูุตุงูุฉ
   - `/material/new`: ุฅุฒุงูุฉ `showroom_id`
   - `/material/<id>/edit`: ุฅุฒุงูุฉ `showroom_id`
   - `get_scoped_query()`: ุงุณุชุซูุงุก `Material`

5. **ุชุญุฏูุซ ุงูุชูุงุฑูุฑ:**
   - ุชูุฑูุฑ ุงูููุงุฏ ุงูููุฎูุถุฉ: ุนุฑุถ ุฌููุน ุงูููุงุฏ
   - ุชูุฑูุฑ ุงุณุชููุงู ุงูููุงุฏ: ุงูููุชุฑุฉ ุญุณุจ ุงูุทูุจุงุช (ูููุณ ุงูููุงุฏ)

**ุงููุฒุงูุง:**
- โ ููุทู ุฃุจุณุท ูุฃูุถุญ
- โ ูุง ุชูุฑุงุฑ ููููุงุฏ
- โ ุฅุฏุงุฑุฉ ููุญุฏุฉ ูููุฎุฒู
- โ ุชุชุจุน ุฏููู ูููููุงุช

**ุงูุนููุจ:**
- โ๏ธ Migration ูุนูุฏุฉ ููููุงู (ุฏูุฌ ุงูููุงุฏ)
- โ๏ธ ุชุบููุฑ ูู ููุทู ุงูุนุฑุถ

---

### ุงูุฎูุงุฑ 2: ุฅุจูุงุก `showroom_id` ูุญูู ุงุฎุชูุงุฑู

**ุงูููุทู:**
- ุจุนุถ ุงูููุงุฏ ูุฏ ุชููู ุฎุงุตุฉ ุจุตุงูุฉ ูุนููุฉ
- ุงูููุงุฏ ุจุฏูู `showroom_id` ุชููู ูุดุชุฑูุฉ

**ุงูุนููุจ:**
- โ ุชุนููุฏ ูู ุงูููุทู
- โ ุงุญุชูุงู ูุฌูุฏ ุชูุฑุงุฑ
- โ ุตุนูุจุฉ ูู ุงูุชุชุจุน

---

## ุงููุฑุงุฑ ุงูููุตู ุจู

**โ ุงูุฎูุงุฑ 1: ุฅุฒุงูุฉ `showroom_id` ูู `Material` ุชูุงูุงู**

### ุงูุฎุทูุงุช ุงูุชูููุฐูุฉ:

#### 1๏ธโฃ ุงููุณุฎ ุงูุงุญุชูุงุทู
```powershell
Copy-Item "kitchen_factory/instance/kitchen_factory.db" `
          "kitchen_factory/instance/kitchen_factory_backup_$(Get-Date -Format 'yyyyMMdd_HHmmss').db"
```

#### 2๏ธโฃ ุชุญููู ุงูุจูุงูุงุช ุงูุญุงููุฉ
```python
# ูุญุต ุงูููุงุฏ ุงูููุฑุฑุฉ ุนุจุฑ ุงูุตุงูุงุช
SELECT name, unit, COUNT(*) as count, GROUP_CONCAT(showroom_id) as showrooms
FROM material
GROUP BY name, unit
HAVING count > 1;
```

#### 3๏ธโฃ Migration Script
- ุฏูุฌ ุงูููุงุฏ ุงูููุฑุฑุฉ
- ุฌูุน ุงููููุงุช
- ุญุณุงุจ ูุชูุณุท ุงูุฃุณุนุงุฑ
- ุญุฐู `showroom_id`

#### 4๏ธโฃ ุชุญุฏูุซ ุงูููุฏ
- ุชุนุฏูู ุงูููุงุฐุฌ
- ุชุญุฏูุซ ุงููุณุงุฑุงุช
- ุชุญุฏูุซ ุงูููุงูุจ
- ุชุญุฏูุซ ุงูุชูุงุฑูุฑ

#### 5๏ธโฃ ุงูุงุฎุชุจุงุฑ
- ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุงุฏุฉ
- ุงุฎุชุจุงุฑ ุชุนุฏูู ูุงุฏุฉ
- ุงุฎุชุจุงุฑ ุงูุทูุจุงุช
- ุงุฎุชุจุงุฑ ุงูุชูุงุฑูุฑ

---

## ุงูุฃููููุฉ

**๐ด ุนุงููุฉ ุฌุฏุงู** - ูุฌุจ ุงูุฅุตูุงุญ ูุจู ุงููุชุงุจุนุฉ ูู ุชุทููุฑ ูุธุงู ุงูููุงุชูุฑ

---

## ุงูุฎุทูุฉ ุงูุชุงููุฉ

ุงูุชุธุงุฑ ููุงููุฉ ุงููุณุชุฎุฏู ุนูู:
1. โ ูู ูููู ุจูุตู ุงููุฎุฒู ุนู ุงูุตุงูุงุชุ
2. โ ูุชู ูุจุฏุฃ (ุงูุขู ุฃู ุจุนุฏ ุฅููุงู ูุธุงู ุงูููุงุชูุฑ)ุ

