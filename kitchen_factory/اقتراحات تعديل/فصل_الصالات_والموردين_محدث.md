# ุฎุทุฉ ูุตู ุงูุตุงูุงุช ูุฅุฏุงุฑุฉ ุงูููุฑุฏูู ูุงูุชุณุนูุฑ - ูุณุฎุฉ ูุญุฏุซุฉ ูุน ุงูุชูุตูุงุช

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-01-07  
**ุงูุฅุตุฏุงุฑ**: 2.0 - ูุน ุฏูุฌ ุงูุชูุตูุงุช ูู ุชูุฑูุฑ ุงููุฑุงุฌุนุฉ

---

## ุงููุฏู ุงูุนุงู
- ุนุฒู ุตูุงุญูุงุช ููุธูู ุงูุงุณุชูุจุงู ุญุณุจ ุงูุตุงูุฉ (Showroom)
- ูุตู ุงูุจูุงูุงุช ุงูุชุดุบูููุฉ ูุงููุงููุฉ ููู ุตุงูุฉ (multi-tenant style)
- **ุงูุนููุงุก ูุดุชุฑููู ุจูู ุงูุตุงูุงุช** (ูููู ุฑุคูุชูู ูู ุฌููุน ุงูุตุงูุงุช)
- ุชุณุฌูู ุงูุตุงูุฉ ุงูุชู ุฌุงุก ูููุง ูู ุทูุจ
- ุฅุถุงูุฉ ูุธุงู ููุฑูุฏูู ูููุงุชูุฑ ุดุฑุงุก ูุน ุฏูุนุงุช ูุฏููู
- ุจูุงุก ุณูุงุณุฉ ุชุณุนูุฑ ุชูููุฉ ูุฑูุฉ ูุน Audit Trail
- ุชูููู ุฅุนุฏุงุฏุงุช ูุฑูุฒูุฉ ูู ุฃุฏูุงุช ุงููุดุฑู ููุชุญูู ูู ุณููู ุงูุชุณุนูุฑ
- Soft Delete ูุญูุงูุฉ ุงูุจูุงูุงุช ุงููููุฉ

---

## ุงูุฌุฒุก ุงูุฃูู: ูุตู ุงูุตุงูุงุช (Showrooms) - ูุญุฏุซ

### ููุงุฐุฌ ุฌุฏูุฏุฉ/ุชุนุฏููุงุช

#### 1. ูููุฐุฌ Showroom (ุฌุฏูุฏ)
```python
class Showroom(db.Model):
    __tablename__ = 'showrooms'
    
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), unique=True, nullable=False)
    code = db.Column(db.String(20), unique=True)  # ููุฏ ูุตูุฑ ููุตุงูุฉ
    address = db.Column(db.String(200))
    phone = db.Column(db.String(20))
    manager_name = db.Column(db.String(100))
    notes = db.Column(db.Text)
    is_active = db.Column(db.Boolean, default=True)
    
    # Soft Delete
    deleted_at = db.Column(db.DateTime)
    deleted_by = db.Column(db.String(100))
    
    # Timestamps
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, onupdate=datetime.utcnow)
    
    # ุงูุนูุงูุงุช
    users = db.relationship('User', back_populates='showroom')
    orders = db.relationship('Order', back_populates='showroom')
    materials = db.relationship('Material', back_populates='showroom')
    suppliers = db.relationship('Supplier', back_populates='showroom')
```

#### 2. User (ุชุนุฏูู)
```python
class User(UserMixin, db.Model):
    # ุงูุญููู ุงูููุฌูุฏุฉ
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(100), unique=True, nullable=False)
    password = db.Column(db.String(200), nullable=False)
    role = db.Column(db.String(50), nullable=False)
    
    # ุญููู ุฌุฏูุฏุฉ
    showroom_id = db.Column(db.Integer, db.ForeignKey('showrooms.id'), nullable=True)
    # nullable=True ูููุฏูุฑูู ุงูุนุงููู
    
    is_active = db.Column(db.Boolean, default=True)
    last_login = db.Column(db.DateTime)
    
    # ุงูุนูุงูุงุช
    showroom = db.relationship('Showroom', back_populates='users')
```

#### 3. Customer (ุชุนุฏูู) - **ููู: ุนููุงุก ูุดุชุฑููู**
```python
class Customer(db.Model):
    # ุงูุญููู ุงูููุฌูุฏุฉ
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    phone = db.Column(db.String(20))
    address = db.Column(db.String(200))
    
    # ุญููู ุฌุฏูุฏุฉ
    email = db.Column(db.String(100))
    tax_id = db.Column(db.String(50))  # ููุดุฑูุงุช
    customer_type = db.Column(db.String(20), default='ูุฑุฏ')  # ูุฑุฏุ ุดุฑูุฉ
    notes = db.Column(db.Text)
    
    # โ๏ธ ูุง ูุถูู showroom_id - ุงูุนููุงุก ูุดุชุฑููู ุจูู ุงูุตุงูุงุช
    
    is_active = db.Column(db.Boolean, default=True)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    # ุงูุนูุงูุงุช
    orders = db.relationship('Order', back_populates='customer')
    
    # Index ููุจุญุซ ุงูุณุฑูุน
    __table_args__ = (
        db.Index('idx_customer_phone', 'phone'),
        db.Index('idx_customer_name', 'name'),
    )
```

#### 4. Order (ุชุนุฏูู) - **ูุณุฌู ุงูุตุงูุฉ**
```python
class Order(db.Model):
    __tablename__ = 'orders'
    
    # ุงูุญููู ุงูููุฌูุฏุฉ
    id = db.Column(db.Integer, primary_key=True)
    customer_id = db.Column(db.Integer, db.ForeignKey('customer.id'), nullable=False)
    order_date = db.Column(db.Date, nullable=False, default=datetime.utcnow)
    delivery_date = db.Column(db.Date)
    deadline = db.Column(db.Date)
    meters = db.Column(db.Integer, nullable=False)
    total_value = db.Column(db.Float, default=0.0)
    status = db.Column(db.String(50), default='ููุชูุญ')
    received_by = db.Column(db.String(100))
    start_date = db.Column(db.Date)
    end_date = db.Column(db.Date)
    
    # ุญููู ุฌุฏูุฏุฉ - ูููุฉ
    showroom_id = db.Column(db.Integer, db.ForeignKey('showrooms.id'), nullable=False)
    # โ ูู ุทูุจ ูุฑุชุจุท ุจุตุงูุฉ ูุงุญุฏุฉ
    
    # ุงูุนูุงูุงุช
    customer = db.relationship('Customer', back_populates='orders')
    showroom = db.relationship('Showroom', back_populates='orders')
    # ... ุจุงูู ุงูุนูุงูุงุช ุงูููุฌูุฏุฉ
    
    # Indexes ููุฃุฏุงุก
    __table_args__ = (
        db.Index('idx_showroom_status', 'showroom_id', 'status'),
        db.Index('idx_showroom_date', 'showroom_id', 'order_date'),
        db.Index('idx_customer_showroom', 'customer_id', 'showroom_id'),
    )
```

#### 5. Material (ุชุนุฏูู) - **ูุน ุณูุงุณุฉ ุงูุชุณุนูุฑ**
```python
class Material(db.Model):
    # ุงูุญููู ุงูููุฌูุฏุฉ
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    unit = db.Column(db.String(50), nullable=False)
    quantity_available = db.Column(db.Float, default=0)
    
    # ุชุนุฏูู ุญููู ุงูุฃุณุนุงุฑ - ุญู ุงูุชุนุงุฑุถ
    cost_price = db.Column(db.Float, default=0)  # ุณุนุฑ ุงูุชูููุฉ (ุงููุญุณูุจ)
    purchase_price = db.Column(db.Float, default=0)  # ุขุฎุฑ ุณุนุฑ ุดุฑุงุก
    selling_price = db.Column(db.Float, default=0)  # ุณุนุฑ ุงูุจูุน (ุงุฎุชูุงุฑู)
    
    # ุณูุงุณุฉ ุงูุชุณุนูุฑ
    cost_price_mode = db.Column(db.String(30), default='purchase_price_default')
    # ุงูููู: purchase_price_default, weighted_average, last_invoice
    
    allow_manual_price_edit = db.Column(db.Boolean, default=True)
    price_locked = db.Column(db.Boolean, default=False)  # ุฅุฐุง ุนูุฏูู ูุฏููุงู
    price_updated_at = db.Column(db.DateTime, default=datetime.utcnow)
    price_updated_by = db.Column(db.String(100))
    
    # ุฑุจุท ุจุงูุตุงูุฉ
    showroom_id = db.Column(db.Integer, db.ForeignKey('showrooms.id'), nullable=False)
    
    # Soft Delete
    is_active = db.Column(db.Boolean, default=True)
    deleted_at = db.Column(db.DateTime)
    
    # ุงูุนูุงูุงุช
    showroom = db.relationship('Showroom', back_populates='materials')
    
    # Validators
    @validates('cost_price', 'purchase_price', 'selling_price')
    def validate_price(self, key, value):
        if value < 0:
            raise ValueError(f"{key} cannot be negative")
        return value
    
    @validates('quantity_available')
    def validate_quantity(self, key, value):
        if value < 0:
            raise ValueError("Quantity cannot be negative")
        return value
```

#### 6. ุฌุฏุงูู ุฃุฎุฑู ุชุญุชุงุฌ showroom_id
- **Stage**: `showroom_id` (NOT NULL)
- **Document**: `showroom_id` (NOT NULL)
- **Payment**: `showroom_id` (NOT NULL) - ุชุจูู ุจุงุณููุง (ูุฏููุนุงุช ุงูุนููุงุก)
- **OrderCost**: `showroom_id` (NOT NULL)
- **MaterialConsumption**: `showroom_id` (NOT NULL)
- **OrderMaterial**: `showroom_id` (NOT NULL)
- **ReceivedOrder**: `showroom_id` (NOT NULL)

---

## ุงูุฌุฒุก ุงูุซุงูู: ุฅุฏุงุฑุฉ ุงูููุฑูุฏูู ูุงูููุงุชูุฑ - ูุญุฏุซ

### ููุงุฐุฌ ุฌุฏูุฏุฉ

#### 1. Supplier (ุฌุฏูุฏ)
```python
class Supplier(db.Model):
    __tablename__ = 'suppliers'
    
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    code = db.Column(db.String(20), unique=True)  # ููุฏ ุงูููุฑุฏ
    phone = db.Column(db.String(20))
    email = db.Column(db.String(100))
    address = db.Column(db.String(200))
    tax_id = db.Column(db.String(50))
    contact_person = db.Column(db.String(100))
    payment_terms = db.Column(db.String(100))  # ุดุฑูุท ุงูุฏูุน
    notes = db.Column(db.Text)
    
    # ุฑุจุท ุจุงูุตุงูุฉ
    showroom_id = db.Column(db.Integer, db.ForeignKey('showrooms.id'), nullable=False)
    
    # Soft Delete
    is_active = db.Column(db.Boolean, default=True)
    deleted_at = db.Column(db.DateTime)
    deleted_by = db.Column(db.String(100))
    
    # Timestamps
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, onupdate=datetime.utcnow)
    created_by = db.Column(db.String(100))
    
    # ุงูุนูุงูุงุช
    showroom = db.relationship('Showroom', back_populates='suppliers')
    invoices = db.relationship('PurchaseInvoice', back_populates='supplier')
    payments = db.relationship('SupplierPayment', back_populates='supplier')
    
    # Computed property
    @property
    def total_debt(self):
        """ุฅุฌูุงูู ุงูุฏููู ุงููุชุจููุฉ"""
        total = 0
        for invoice in self.invoices:
            if invoice.status != 'paid':
                total += invoice.remaining_amount
        return total
```

#### 2. PurchaseInvoice (ุฌุฏูุฏ) - **ูุญุณูู**
```python
class PurchaseInvoice(db.Model):
    __tablename__ = 'purchase_invoices'
    
    id = db.Column(db.Integer, primary_key=True)
    invoice_number = db.Column(db.String(50), unique=True, nullable=False)
    supplier_id = db.Column(db.Integer, db.ForeignKey('suppliers.id'), nullable=False)
    showroom_id = db.Column(db.Integer, db.ForeignKey('showrooms.id'), nullable=False)
    
    invoice_date = db.Column(db.Date, nullable=False, default=datetime.utcnow)
    due_date = db.Column(db.Date)
    
    # ุงููุจุงูุบ
    total_amount = db.Column(db.Float, nullable=False, default=0)
    discount_amount = db.Column(db.Float, default=0)
    tax_amount = db.Column(db.Float, default=0)
    final_amount = db.Column(db.Float, nullable=False, default=0)
    
    # ุงูุญุงูุฉ
    status = db.Column(db.String(20), default='open')
    # ุงูููู: open, partial, paid, overdue, cancelled
    
    notes = db.Column(db.Text)
    
    # Soft Delete
    is_active = db.Column(db.Boolean, default=True)
    cancelled_at = db.Column(db.DateTime)
    cancelled_by = db.Column(db.String(100))
    cancellation_reason = db.Column(db.Text)
    
    # Timestamps
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    created_by = db.Column(db.String(100))
    updated_at = db.Column(db.DateTime, onupdate=datetime.utcnow)
    
    # ุงูุนูุงูุงุช
    supplier = db.relationship('Supplier', back_populates='invoices')
    showroom = db.relationship('Showroom')
    items = db.relationship('PurchaseInvoiceItem', back_populates='invoice', 
                           cascade='all, delete-orphan')
    payments = db.relationship('SupplierPayment', back_populates='invoice')
    
    # Computed properties - ุจุฏู ุญููู ููุฑุฑุฉ
    @property
    def paid_amount(self):
        """ุงููุจูุบ ุงููุฏููุน - ูุญุณูุจ ูู ุงูุฏูุนุงุช"""
        return sum(p.amount for p in self.payments if p.is_active)
    
    @property
    def remaining_amount(self):
        """ุงููุจูุบ ุงููุชุจูู"""
        return self.final_amount - self.paid_amount
    
    # Indexes
    __table_args__ = (
        db.Index('idx_supplier_showroom', 'supplier_id', 'showroom_id'),
        db.Index('idx_invoice_date', 'invoice_date'),
        db.Index('idx_invoice_status', 'status'),
    )
```

#### 3. PurchaseInvoiceItem (ุฌุฏูุฏ) - **ูุญุณูู**
```python
class PurchaseInvoiceItem(db.Model):
    __tablename__ = 'purchase_invoice_items'
    
    id = db.Column(db.Integer, primary_key=True)
    invoice_id = db.Column(db.Integer, db.ForeignKey('purchase_invoices.id'), nullable=False)
    material_id = db.Column(db.Integer, db.ForeignKey('material.id'), nullable=False)
    
    quantity = db.Column(db.Float, nullable=False)
    purchase_price = db.Column(db.Float, nullable=False)  # ุณุนุฑ ุงูุดุฑุงุก ูููุญุฏุฉ
    
    discount_percent = db.Column(db.Float, default=0)
    discount_amount = db.Column(db.Float, default=0)
    
    notes = db.Column(db.String(200))
    
    # ุงูุนูุงูุงุช
    invoice = db.relationship('PurchaseInvoice', back_populates='items')
    material = db.relationship('Material')
    
    # Computed property - ุจุฏู ุญูู ูุฎุฒู
    @property
    def line_total(self):
        """ุฅุฌูุงูู ุงูุณุทุฑ"""
        subtotal = self.quantity * self.purchase_price
        return subtotal - self.discount_amount
    
    # Validators
    @validates('quantity', 'purchase_price')
    def validate_positive(self, key, value):
        if value < 0:
            raise ValueError(f"{key} must be positive")
        return value
```

#### 4. SupplierPayment (ุฌุฏูุฏ) - **ูุญุณูู**
```python
class SupplierPayment(db.Model):
    __tablename__ = 'supplier_payments'
    
    id = db.Column(db.Integer, primary_key=True)
    supplier_id = db.Column(db.Integer, db.ForeignKey('suppliers.id'), nullable=False)
    invoice_id = db.Column(db.Integer, db.ForeignKey('purchase_invoices.id'), nullable=False)
    # โ invoice_id required - supplier_id ูุญุตู ุนููู ูู ุงููุงุชูุฑุฉ
    
    amount = db.Column(db.Float, nullable=False)
    payment_method = db.Column(db.String(50), default='ููุฏ')
    # ุงูููู: ููุฏุ ุจููุ ุดููุ ุชุญูููุ ุขุฌู
    
    payment_date = db.Column(db.Date, nullable=False, default=datetime.utcnow)
    reference_number = db.Column(db.String(50))  # ุฑูู ุงููุฑุฌุน/ุงูุดูู
    
    notes = db.Column(db.Text)
    paid_by = db.Column(db.String(100), nullable=False)  # ุงูููุธู ุงูุฐู ุณุฌู ุงูุฏูุน
    
    # Soft Delete
    is_active = db.Column(db.Boolean, default=True)
    cancelled_at = db.Column(db.DateTime)
    cancelled_by = db.Column(db.String(100))
    
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    # ุงูุนูุงูุงุช
    supplier = db.relationship('Supplier', back_populates='payments')
    invoice = db.relationship('PurchaseInvoice', back_populates='payments')
    
    # Validators
    @validates('amount')
    def validate_amount(self, key, value):
        if value <= 0:
            raise ValueError("Payment amount must be positive")
        return value
```

### ุชุฏูู ุงูุนูู - ูุญุฏุซ
1. **ุฅูุดุงุก ูุงุชูุฑุฉ ุดุฑุงุก**:
   - ุฅุถุงูุฉ ุฑุฃุณ ุงููุงุชูุฑุฉ (supplier, date, etc)
   - ุฅุถุงูุฉ ุนูุงุตุฑ ุงููุงุชูุฑุฉ (items)
   - ุญุณุงุจ ุงูุฅุฌูุงููุงุช ุชููุงุฆูุงู
   
2. **ุชุญุฏูุซ ุงููุฎุฒูู** (ุนูุฏ ุชูุนูู ุงููุงุชูุฑุฉ):
   - ููู ุนูุตุฑ: `Material.quantity_available += quantity`
   - ุชุญุฏูุซ `Material.purchase_price = item.purchase_price`
   - ุญุณุงุจ `Material.cost_price` ููู ุงูุณูุงุณุฉ ุงููุฎุชุงุฑุฉ
   - ุชุณุฌูู ูู Audit Log
   
3. **ุชุณุฌูู ุงูุฏูุนุงุช**:
   - ุฅุถุงูุฉ ุฏูุนุฉ ูุฑุชุจุทุฉ ุจุงููุงุชูุฑุฉ
   - ุญุณุงุจ `paid_amount` ู `remaining_amount` ุชููุงุฆูุงู
   - ุชุญุฏูุซ `status` (open โ partial โ paid)
   
4. **ุงูุชุญุฐูุฑุงุช ุงูุชููุงุฆูุฉ**:
   - ุชุญุฏูุฏ ุงูููุงุชูุฑ ุงููุชุฃุฎุฑุฉ (due_date < today and status != 'paid')
   - ุชูุจููุงุช ุงูุฎูุงุถ ุงููุฎุฒูู

---

## ุงูุฌุฒุก ุงูุซุงูุซ: ุณูุงุณุฉ ุชุณุนูุฑ ุงูุชูููุฉ - ูุญุฏุซ

### ุณูุงุณุงุช ูุฏุนููุฉ
```python
class CostPricingMode:
    PURCHASE_DEFAULT = 'purchase_price_default'  # ุงูุชุฑุงุถู - ุขุฎุฑ ุณุนุฑ ุดุฑุงุก
    WEIGHTED_AVERAGE = 'weighted_average'  # ูุชูุณุท ูุฑุฌูุญ
    LAST_INVOICE = 'last_invoice'  # ุขุฎุฑ ูุงุชูุฑุฉ
```

### ููุทู ุงูุญุณุงุจ - ูุน Audit
```python
def update_material_cost_price(material, new_purchase_price, quantity, invoice_id):
    """
    ุชุญุฏูุซ ุณุนุฑ ุงูุชูููุฉ ููู ุงูุณูุงุณุฉ ุงููุฎุชุงุฑุฉ
    """
    old_price = material.cost_price
    old_qty = material.quantity_available
    
    # ุชุญูู: ูู ุงูุณุนุฑ ูููู (ูุนุฏูู ูุฏููุงู)ุ
    if material.price_locked and not material.allow_manual_price_edit:
        # ูุง ุชุญุฏุซ - ุงูุณุนุฑ ูุญูู
        return
    
    # ุทุจูู ุงูุณูุงุณุฉ
    if material.cost_price_mode == 'purchase_price_default':
        material.cost_price = new_purchase_price
    
    elif material.cost_price_mode == 'weighted_average':
        # ูุชูุณุท ูุฑุฌูุญ
        total_cost = (old_price * old_qty) + (new_purchase_price * quantity)
        total_qty = old_qty + quantity
        material.cost_price = total_cost / total_qty if total_qty > 0 else new_purchase_price
    
    elif material.cost_price_mode == 'last_invoice':
        material.cost_price = new_purchase_price
    
    # ุชุณุฌูู ุขุฎุฑ ุณุนุฑ ุดุฑุงุก
    material.purchase_price = new_purchase_price
    material.price_updated_at = datetime.utcnow()
    material.price_updated_by = current_user.username
    
    # ุชุณุฌูู ูู Audit Log
    log_price_change(
        table='material',
        record_id=material.id,
        field='cost_price',
        old_value=old_price,
        new_value=material.cost_price,
        reason=f'Updated from invoice {invoice_id}'
    )
```

### ุนูุงุตุฑ ุงูุชุญูู ูู ุฃุฏูุงุช ุงููุดุฑู
```python
class SystemSettings(db.Model):
    """ุฅุนุฏุงุฏุงุช ุงููุธุงู ุงููุฑูุฒูุฉ"""
    __tablename__ = 'system_settings'
    
    id = db.Column(db.Integer, primary_key=True)
    key = db.Column(db.String(100), unique=True, nullable=False)
    value = db.Column(db.Text)
    value_type = db.Column(db.String(20), default='string')  # string, int, bool, json
    category = db.Column(db.String(50))  # pricing, permissions, general
    description = db.Column(db.String(200))
    
    showroom_id = db.Column(db.Integer, nullable=True)  # null = system-wide
    
    updated_at = db.Column(db.DateTime, onupdate=datetime.utcnow)
    updated_by = db.Column(db.String(100))

# ุฃูุซูุฉ ุฅุนุฏุงุฏุงุช:
# key='default_cost_price_mode', value='purchase_price_default', category='pricing'
# key='allow_manual_cost_edit_role_reception', value='false', category='permissions'
# key='low_stock_threshold', value='10', value_type='int', category='inventory'
```

---

## ุงูุฌุฒุก ุงูุฑุงุจุน: ุตูุงุญูุงุช ูุฃุฐููุงุช - ูุญุฏุซ

### Helper Functions

```python
def get_scoped_query(model_class, user=None):
    """
    ุชุฑุฌุน Query ูุตููู ุญุณุจ showroom_id ูููุณุชุฎุฏู
    """
    from flask import session
    user = user or current_user
    query = model_class.query
    
    # ุชุญูู: ูู ุงููููุฐุฌ ูุญุชูู ุนูู showroom_idุ
    if not hasattr(model_class, 'showroom_id'):
        return query
    
    # ุงููุฏูุฑ ูุฑู ุญุณุจ ุงูููุชุฑ ุงููุฎุชุงุฑ
    if user.role == 'ูุฏูุฑ':
        showroom_filter = session.get('showroom_filter', 'all')
        if showroom_filter != 'all':
            query = query.filter_by(showroom_id=int(showroom_filter))
    
    # ููุธููู ุขุฎุฑูู ูุฑูู ุตุงูุชูู ููุท
    elif user.showroom_id:
        query = query.filter_by(showroom_id=user.showroom_id)
    
    # ุชุตููุฉ Soft Delete
    if hasattr(model_class, 'is_active'):
        query = query.filter_by(is_active=True)
    
    return query

# ุงุณุชุฎุฏุงู:
# orders = get_scoped_query(Order).filter_by(status='ููุชูุญ').all()
```

### Decorator ููุญูุงูุฉ
```python
from functools import wraps
from flask import flash, redirect, url_for, session

def require_showroom_access(f):
    """
    Decorator ูุญูุงูุฉ ุงููุณุงุฑุงุช - ูุชุฃูุฏ ุฃู ุงููุณุชุฎุฏู ูู ุตูุงุญูุฉ ุงูุตุงูุฉ
    """
    @wraps(f)
    def decorated_function(*args, **kwargs):
        showroom_id = kwargs.get('showroom_id')
        
        # ุงููุฏูุฑ ูู ุตูุงุญูุฉ ูู ุงูุตุงูุงุช
        if current_user.role == 'ูุฏูุฑ':
            return f(*args, **kwargs)
        
        # ููุธู ุจุตุงูุฉ ูุญุฏุฏุฉ
        if current_user.showroom_id and current_user.showroom_id == int(showroom_id):
            return f(*args, **kwargs)
        
        flash('ููุณ ูุฏูู ุตูุงุญูุฉ ูููุตูู ุฅูู ูุฐู ุงูุตุงูุฉ', 'danger')
        return redirect(url_for('dashboard'))
    
    return decorated_function

# ุงุณุชุฎุฏุงู:
@app.route('/showroom/<int:showroom_id>/orders')
@login_required
@require_showroom_access
def showroom_orders(showroom_id):
    orders = get_scoped_query(Order).all()
    return render_template('orders.html', orders=orders)
```

### ูุตูููุฉ ุงูุตูุงุญูุงุช
| ุงูุฏูุฑ | ุงูุนููุงุก | ุงูุทูุจุงุช | ุงูููุงุฏ | ุงูููุฑุฏูู | ุงูููุงุชูุฑ | ุงูุฅุนุฏุงุฏุงุช |
|-------|---------|---------|--------|-----------|----------|-----------|
| **ูุฏูุฑ** | ุนุฑุถ ุงููู | ุนุฑุถ/ุชุนุฏูู ุงููู | ุนุฑุถ/ุชุนุฏูู ุงููู | ุนุฑุถ/ุชุนุฏูู ุงููู | ุนุฑุถ/ุชุนุฏูู ุงููู | โ ูุงูู |
| **ููุธู ุงุณุชูุจุงู** | ุนุฑุถ ุงูููุ ุฅุถุงูุฉ | ุตุงูุชู ููุท | ุนุฑุถ ููุท | โ | โ | โ |
| **ูุณุคูู ูุฎุฒู** | ุนุฑุถ | ุนุฑุถ ุตุงูุชู | ุตุงูุชู ููุท | ุตุงูุชู ููุท | ุตุงูุชู ููุท | โ |
| **ูุณุคูู ุฅูุชุงุฌ** | ุนุฑุถ | ุตุงูุชู ููุท | ุตุงูุชู (ุนุฑุถ) | โ | โ | โ |
| **ูุณุคูู ุนูููุงุช** | ุนุฑุถ ุงููู | ุตุงูุชู ููุท | ุตุงูุชู ููุท | ุตุงูุชู ููุท | ุตุงูุชู (ุนุฑุถ) | ูุญุฏูุฏ |

**ููุงุญุธุฉ ูููุฉ**: 
- โ **ุงูุนููุงุก ูุฑุฆููู ููุฌููุน** (ุจุญุซ ุดุงูู)
- โ ููู **ุงูุทูุจุงุช ูููุฏุฉ ุจุงูุตุงูุฉ** (ุนุฒู ุชุงู)
- โ ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏุ ููุณุฌู `showroom_id` ุชููุงุฆูุงู ูู ุงููุณุชุฎุฏู

---

## ุงูุฌุฒุก ุงูุฎุงูุณ: Audit Log ูุงูุชุชุจุน - ุฌุฏูุฏ

### ูููุฐุฌ AuditLog
```python
class AuditLog(db.Model):
    """ุณุฌู ุงูุชุฏููู ูุชุชุจุน ุงูุชุบููุฑุงุช ุงููููุฉ"""
    __tablename__ = 'audit_logs'
    
    id = db.Column(db.Integer, primary_key=True)
    
    # ูุง ุงูุฐู ุชุบูุฑุ
    table_name = db.Column(db.String(50), nullable=False)
    record_id = db.Column(db.Integer, nullable=False)
    action = db.Column(db.String(20), nullable=False)  # create, update, delete
    
    # ุชูุงุตูู ุงูุชุบููุฑ
    field_name = db.Column(db.String(50))  # ููู update
    old_value = db.Column(db.Text)
    new_value = db.Column(db.Text)
    
    # ููุ ูุชูุ ุฃููุ
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    user_name = db.Column(db.String(100))
    showroom_id = db.Column(db.Integer, db.ForeignKey('showrooms.id'))
    timestamp = db.Column(db.DateTime, default=datetime.utcnow)
    ip_address = db.Column(db.String(50))
    
    # ุณุจุจ ุงูุชุบููุฑ (ุงุฎุชูุงุฑู)
    reason = db.Column(db.Text)
    
    # Indexes
    __table_args__ = (
        db.Index('idx_audit_table_record', 'table_name', 'record_id'),
        db.Index('idx_audit_user', 'user_id'),
        db.Index('idx_audit_timestamp', 'timestamp'),
    )

def log_change(table, record_id, action, field=None, old_val=None, new_val=None, reason=None):
    """ุฏุงูุฉ ูุณุงุนุฏุฉ ูุชุณุฌูู ุงูุชุบููุฑุงุช"""
    log = AuditLog(
        table_name=table,
        record_id=record_id,
        action=action,
        field_name=field,
        old_value=str(old_val) if old_val else None,
        new_value=str(new_val) if new_val else None,
        user_id=current_user.id if current_user.is_authenticated else None,
        user_name=current_user.username if current_user.is_authenticated else 'system',
        showroom_id=current_user.showroom_id if current_user.is_authenticated else None,
        ip_address=request.remote_addr if request else None,
        reason=reason
    )
    db.session.add(log)
```

### ูุชู ูุณุชุฎุฏู Audit Logุ
- โ ุชุบููุฑุงุช ุงูุฃุณุนุงุฑ (cost_price, purchase_price, selling_price)
- โ ุชุบููุฑุงุช ุงููููุงุช (quantity_available)
- โ ุฅูุบุงุก ุงูููุงุชูุฑ
- โ ุญุฐู ุงูุณุฌูุงุช ุงููููุฉ
- โ ุชุนุฏูู ุงูุฃุฐููุงุช ูุงูุตูุงุญูุงุช

---

## ุงูุฌุฒุก ุงูุณุงุฏุณ: ุชุนุฏููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช - ูุงููุฉ

### Migration 1: ุฅูุดุงุก Showroom ูุฅุถุงูุฉ showroom_id
```python
# ุฅูุดุงุก ุฌุฏูู Showroom
op.create_table('showrooms', ...)

# ุฅุถุงูุฉ showroom_id ููุฌุฏุงูู ุงูููุฌูุฏุฉ
tables_to_update = [
    'user',  # nullable
    # 'customer',  # โ ูุง ูุถูู - ุนููุงุก ูุดุชุฑููู
    'orders', 'material', 'stage', 'document', 
    'payment', 'order_cost', 'material_consumption', 
    'order_material', 'received_order'
]

for table in tables_to_update:
    nullable = (table == 'user')  # ุงููุฏูุฑูู ุจุฏูู ุตุงูุฉ
    op.add_column(table, 
        sa.Column('showroom_id', sa.Integer(), 
                  sa.ForeignKey('showrooms.id'), 
                  nullable=nullable)
    )

# ุฅูุดุงุก ุตุงูุฉ ุงูุชุฑุงุถูุฉ
op.execute("""
    INSERT INTO showrooms (name, code, is_active) 
    VALUES ('ุงูุตุงูุฉ ุงูุฑุฆูุณูุฉ', 'MAIN', 1)
""")

# ุฅุณูุงุฏ ุงูุจูุงูุงุช ุงูุญุงููุฉ ููุตุงูุฉ ุงูุงูุชุฑุงุถูุฉ
for table in tables_to_update:
    if table != 'user':
        op.execute(f"UPDATE {table} SET showroom_id = 1")
```

### Migration 2: ุชุนุฏูู Material ููุชุณุนูุฑ
```python
# ุฅุถุงูุฉ ุญููู ุงูุชุณุนูุฑ ุงูุฌุฏูุฏุฉ
op.add_column('material', sa.Column('cost_price', sa.Float(), default=0))
op.add_column('material', sa.Column('purchase_price', sa.Float(), default=0))
op.add_column('material', sa.Column('selling_price', sa.Float(), default=0))
op.add_column('material', sa.Column('cost_price_mode', sa.String(30), default='purchase_price_default'))
op.add_column('material', sa.Column('allow_manual_price_edit', sa.Boolean(), default=True))
op.add_column('material', sa.Column('price_locked', sa.Boolean(), default=False))
op.add_column('material', sa.Column('price_updated_by', sa.String(100)))

# ูุณุฎ ุงูุจูุงูุงุช ุงููุฏููุฉ
op.execute("UPDATE material SET cost_price = unit_price, purchase_price = unit_price")

# ููุงุญุธุฉ: ูููู ุงูุงุญุชูุงุธ ุจู unit_price ููุชูุงูู ุฃู ุญุฐูู ูุงุญูุงู
```

### Migration 3: ุงูููุฑุฏูู ูุงูููุงุชูุฑ
```python
# ุฅูุดุงุก ุฌุฏุงูู ุงูููุฑุฏูู
op.create_table('suppliers', ...)
op.create_table('purchase_invoices', ...)
op.create_table('purchase_invoice_items', ...)
op.create_table('supplier_payments', ...)

# Indexes
op.create_index('idx_supplier_showroom', 'suppliers', ['showroom_id'])
op.create_index('idx_invoice_date', 'purchase_invoices', ['invoice_date'])
op.create_index('idx_invoice_status', 'purchase_invoices', ['status'])
```

### Migration 4: Audit Log ูุงูุฅุนุฏุงุฏุงุช
```python
op.create_table('audit_logs', ...)
op.create_table('system_settings', ...)

# Indexes
op.create_index('idx_audit_table_record', 'audit_logs', ['table_name', 'record_id'])
op.create_index('idx_audit_timestamp', 'audit_logs', ['timestamp'])
```

---

## ุงูุฌุฒุก ุงูุณุงุจุน: ูุงุฌูุงุช ุงููุณุชุฎุฏู - ูุญุฏุซ

### 1. Navbar - Showroom Selector
```html
<!-- ูู base.html -->
{% if current_user.role == 'ูุฏูุฑ' %}
<div class="showroom-selector">
    <label>ุงูุตุงูุฉ:</label>
    <select id="showroom_filter" class="form-select">
        <option value="all">ุฌููุน ุงูุตุงูุงุช</option>
        {% for showroom in showrooms %}
        <option value="{{ showroom.id }}" 
                {% if session.get('showroom_filter') == showroom.id %}selected{% endif %}>
            {{ showroom.name }}
        </option>
        {% endfor %}
    </select>
</div>
{% elif current_user.showroom %}
<div class="showroom-badge">
    <span class="badge bg-primary">{{ current_user.showroom.name }}</span>
</div>
{% endif %}
```

### 2. ุตูุญุฉ ุงูุนููุงุก - ูุดุชุฑูุฉ
```html
<!-- customers.html -->
<div class="card">
    <div class="card-header">
        <h5>ูุงุฆูุฉ ุงูุนููุงุก (ูุดุชุฑูุฉ ุจูู ุงูุตุงูุงุช)</h5>
        <small class="text-muted">ููููู ุฑุคูุฉ ุฌููุน ุงูุนููุงุก ูู ูู ุงูุตุงูุงุช</small>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>ุงูุงุณู</th>
                    <th>ุงููุงุชู</th>
                    <th>ุนุฏุฏ ุงูุทูุจุงุช</th>
                    <th>ุขุฎุฑ ุทูุจ ูู</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr>
                    <td>{{ customer.name }}</td>
                    <td>{{ customer.phone }}</td>
                    <td>{{ customer.orders|length }}</td>
                    <td>
                        {% set last_order = customer.orders|selectattr("showroom_id", "equalto", current_user.showroom_id)|first %}
                        {{ last_order.order_date if last_order else '-' }}
                    </td>
                    <td>
                        <a href="{{ url_for('customer_detail', customer_id=customer.id) }}">
                            ุนุฑุถ
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
```

### 3. ุตูุญุฉ ุงูุทูุจุงุช - ูุตูุงุฉ ุจุงูุตุงูุฉ
```python
@app.route('/orders')
@login_required
def orders():
    # ุงุณุชุฎุฏุงู Helper ููุชุตููุฉ ุงูุชููุงุฆูุฉ
    orders = get_scoped_query(Order).order_by(Order.order_date.desc()).all()
    return render_template('orders.html', orders=orders)
```

### 4. ุตูุญุงุช ุงูููุฑุฏูู
```html
<!-- suppliers.html -->
<a href="{{ url_for('new_supplier') }}" class="btn btn-primary">
    <i class="fas fa-plus"></i> ุฅุถุงูุฉ ููุฑุฏ ุฌุฏูุฏ
</a>

<!-- purchase_invoices.html -->
<a href="{{ url_for('new_purchase_invoice') }}" class="btn btn-success">
    <i class="fas fa-file-invoice"></i> ูุงุชูุฑุฉ ุดุฑุงุก ุฌุฏูุฏุฉ
</a>
```

### 5. ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุฃุฏูุงุช ุงููุดุฑู
```html
<!-- admin_settings.html -->
<div class="card">
    <div class="card-header">
        <h5>ุฅุนุฏุงุฏุงุช ุณูุงุณุฉ ุงูุชุณุนูุฑ</h5>
    </div>
    <div class="card-body">
        <form method="POST">
            <div class="mb-3">
                <label>ุงูุณูุงุณุฉ ุงูุงูุชุฑุงุถูุฉ:</label>
                <select name="default_cost_price_mode" class="form-select">
                    <option value="purchase_price_default">ุขุฎุฑ ุณุนุฑ ุดุฑุงุก (ุงูุชุฑุงุถู)</option>
                    <option value="weighted_average">ูุชูุณุท ูุฑุฌูุญ</option>
                    <option value="last_invoice">ุขุฎุฑ ูุงุชูุฑุฉ</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label>
                    <input type="checkbox" name="allow_manual_edit_reception"> 
                    ุงูุณูุงุญ ูููุธูู ุงูุงุณุชูุจุงู ุจุชุนุฏูู ุงูุฃุณุนุงุฑ
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
        </form>
    </div>
</div>

<!-- Materials Pricing Policy -->
<div class="card mt-3">
    <div class="card-header">
        <h5>ุณูุงุณุฉ ุชุณุนูุฑ ุงูุฃุตูุงู</h5>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>ุงููุงุฏุฉ</th>
                    <th>ุงูุณูุงุณุฉ ุงูุญุงููุฉ</th>
                    <th>ุณุนุฑ ุงูุชูููุฉ</th>
                    <th>ููู ุงูุณุนุฑ</th>
                    <th>ุชุนุฏูู</th>
                </tr>
            </thead>
            <tbody>
                {% for material in materials %}
                <tr>
                    <td>{{ material.name }}</td>
                    <td>{{ material.cost_price_mode }}</td>
                    <td>{{ material.cost_price }}</td>
                    <td>
                        <i class="fas fa-{{ 'lock' if material.price_locked else 'lock-open' }}"></i>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-warning" 
                                onclick="editMaterialPolicy({{ material.id }})">
                            ุชุนุฏูู
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
```

---

## ุงูุฌุฒุก ุงูุซุงูู: ุฎุทุฉ ุงูุชุฑุญูู ูุงูุชูููุฐ - ููุตูุฉ

### ุงููุฑุญูุฉ 1: ุชุญุถูุฑ ูุชูุธูู (ุฃุณุจูุน 1)
**ุงูุฃูุฏุงู**: ุชูุธูู ุงูููุฏ ูุฅุนุฏุงุฏ ุงูุจูุฆุฉ

1. โ ุชูุธูู ุฅุดุงุฑุงุช `ProductionStage` ุงููุฏููุฉ
2. โ ุฅุนุงุฏุฉ ุชุณููุฉ `Material.unit_price` โ `cost_price` (ุฃู ุฅุถุงูุฉ ุญููู ูููุตูุฉ)
3. โ ุฅุถุงูุฉ Validators ููููุงุฐุฌ ุงูุญุงููุฉ
4. โ ูุชุงุจุฉ Unit Tests ูููุธุงุฆู ุงูุญุงููุฉ
5. โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงููุฎุฑุฌุงุช**:
- ููุฏ ูุธูู ุจุฏูู ุชุนุงุฑุถุงุช
- Suite ุงุฎุชุจุงุฑ ุฃุณุงุณู
- ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุขููุฉ

---

### ุงููุฑุญูุฉ 2: ุฅุถุงูุฉ Showroom ูุงูุนุฒู (ุฃุณุจูุน 2)
**ุงูุฃูุฏุงู**: ุชุทุจูู ูุตู ุงูุตุงูุงุช

**ุงูุฎุทูุงุช**:
1. ุฅูุดุงุก ูููุฐุฌ `Showroom`
2. Migration ูุฅุถุงูุฉ `showroom_id` ููุฌุฏุงูู (ุนุฏุง Customer)
3. ุฅูุดุงุก ุตุงูุฉ ุงูุชุฑุงุถูุฉ ูุฅุณูุงุฏ ุงูุจูุงูุงุช
4. ุชุญุฏูุซ `User` model
5. ูุชุงุจุฉ Helpers: `get_scoped_query()`, `@require_showroom_access`
6. ุชุญุฏูุซ ุฌููุน ุงููุณุงุฑุงุช ูุงุณุชุฎุฏุงู Helpers
7. ุฅุถุงูุฉ Showroom Selector ูู Navbar
8. ุงุฎุชุจุงุฑุงุช ุงูุนุฒู

**ุงููุฎุฑุฌุงุช**:
- ุนุฒู ูุงูู ุจูู ุงูุตุงูุงุช
- ููุธููู ูุฑูู ุตุงูุชูู ููุท
- ูุฏูุฑูู ูููููู ุงูุชุจุฏูู ุจูู ุงูุตุงูุงุช

---

### ุงููุฑุญูุฉ 3: ุงูููุฑุฏูู ูุงูููุงุชูุฑ (ุฃุณุจูุน 3-4)
**ุงูุฃูุฏุงู**: ุฅุถุงูุฉ ููุธููุฉ ุงูููุฑุฏูู

**ุงูุฎุทูุงุช**:
1. ุฅูุดุงุก ููุงุฐุฌ: Supplier, PurchaseInvoice, PurchaseInvoiceItem, SupplierPayment
2. Migration ููุฌุฏุงูู ุงูุฌุฏูุฏุฉ
3. CRUD ููููุฑุฏูู:
   - ูุงุฆูุฉ ุงูููุฑุฏูู
   - ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู (soft delete)
4. ููุงุชูุฑ ุงูุดุฑุงุก:
   - ุฅูุดุงุก ูุงุชูุฑุฉ ูุน ุนูุงุตุฑูุง
   - ุนุฑุถ ุชูุงุตูู ุงููุงุชูุฑุฉ
   - ุชุญุฏูุซ ุงููุฎุฒูู ุนูุฏ ุงูุชูุนูู
5. ุฏูุนุงุช ุงูููุฑุฏูู:
   - ุชุณุฌูู ุฏูุนุฉ
   - ุญุณุงุจ ุงููุชุจูู
   - ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ
6. ุชูุงุฑูุฑ:
   - ุฏููู ุงูููุฑุฏูู
   - ููุงุชูุฑ ูุชุฃุฎุฑุฉ
7. ุงุฎุชุจุงุฑุงุช ุงูุชุฏูู ุงููุงูู

**ุงููุฎุฑุฌุงุช**:
- ูุธุงู ููุฑุฏูู ูุงูู
- ุชูุงูู ูุน ุงููุฎุฒูู
- ุชูุงุฑูุฑ ุงูุฏููู

---

### ุงููุฑุญูุฉ 4: ุณูุงุณุงุช ุงูุชุณุนูุฑ (ุฃุณุจูุน 5)
**ุงูุฃูุฏุงู**: ุชุทุจูู ุงูุชุณุนูุฑ ุงูุฐูู

**ุงูุฎุทูุงุช**:
1. ุฅูุดุงุก `SystemSettings` model
2. ุชุญุฏูุซ `Material` ุจุญููู ุงูุชุณุนูุฑ
3. ุชุทุจูู ููุทู ุงูุญุณุงุจ:
   ```python
   def apply_cost_pricing_policy(material, invoice_item):
       # ...
   ```
4. ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุงูุชุณุนูุฑ ูู ุฃุฏูุงุช ุงููุดุฑู
5. ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุณูุงุณุงุช ุงูุฃุตูุงู
6. Audit Log ููุฃุณุนุงุฑ
7. ุงุฎุชุจุงุฑุงุช ุงูุณูุงุณุงุช ุงููุฎุชููุฉ

**ุงููุฎุฑุฌุงุช**:
- ุชุณุนูุฑ ุชููุงุฆู ุญุณุจ ุงูุณูุงุณุฉ
- ุฅููุงููุฉ ุงูุชุฎุตูุต ููู ุตูู
- ุชุชุจุน ุชุบููุฑุงุช ุงูุฃุณุนุงุฑ

---

### ุงููุฑุญูุฉ 5: Audit Log ูุงูุชุชุจุน (ุฃุณุจูุน 6)
**ุงูุฃูุฏุงู**: ุชุชุจุน ุดุงูู ููุชุบููุฑุงุช

**ุงูุฎุทูุงุช**:
1. ุฅูุดุงุก `AuditLog` model
2. ุฏุงูุฉ `log_change()` helper
3. ุชุทุจูู Logging ุนูู:
   - ุชุบููุฑุงุช ุงูุฃุณุนุงุฑ
   - ุชุบููุฑุงุช ุงููููุงุช
   - ุญุฐู/ุฅูุบุงุก ุงูุณุฌูุงุช
4. ุตูุญุฉ ุนุฑุถ ุณุฌู ุงูุชุฏููู
5. ููุงุชุฑ ูุจุญุซ ูู ุงูุณุฌู
6. ุชูุฑูุฑ ูุดุงุทุงุช ุงููุณุชุฎุฏููู

**ุงููุฎุฑุฌุงุช**:
- ุชุชุจุน ูุงูู ููุชุบููุฑุงุช ุงููููุฉ
- ูุญุงุณุจุฉ ููุฑุงุฌุนุฉ
- ุฃูุงู ูุดูุงููุฉ

---

### ุงููุฑุญูุฉ 6: ุงููุงุฌูุงุช ูุงูุชุญุณููุงุช (ุฃุณุจูุน 7)
**ุงูุฃูุฏุงู**: ุชุญุณูู UX ูุฅุถุงูุฉ ุชูุงุฑูุฑ

**ุงูุฎุทูุงุช**:
1. ุชุญุณูู Navbar ูุงูุชููู
2. ุชุญุณูู ุตูุญุงุช ุงูุนููุงุก (ูุดุชุฑูุฉ)
3. Dashboard ุจุฅุญุตุงุฆูุงุช ุญุณุจ ุงูุตุงูุฉ
4. ุชูุงุฑูุฑ ูุชูุฏูุฉ:
   - ุฑุจุญูุฉ ุงูุตุงูุงุช
   - ุฏูุฑุงู ุงููุฎุฒูู
   - ุฃุฏุงุก ุงูููุฑุฏูู
5. ุชุตุฏูุฑ CSV/PDF
6. ุชุญุณููุงุช UX ุงูุนุงูุฉ
7. ุชูุซูู ุงููุณุชุฎุฏู

**ุงููุฎุฑุฌุงุช**:
- ูุงุฌูุงุช ุณูุณุฉ ูุณููุฉ
- ุชูุงุฑูุฑ ุดุงููุฉ
- ุชุตุฏูุฑ ุงูุจูุงูุงุช

---

## ุงูุฌุฒุก ุงูุชุงุณุน: ุงููุฎุงุทุฑ ูุงูุชุญุฏูุงุช - ูุญุฏุซ

### โ๏ธ ุฎุทุฑ 1: ูุฌุฑุฉ ุงูุจูุงูุงุช
**ุงูุชุฎููู**:
- โ 3 ูุณุฎ ุงุญุชูุงุทูุฉ: ูุจูุ ุฃุซูุงุกุ ุจุนุฏ
- โ ุงุฎุชุจุงุฑ Migrations ูู ุจูุฆุฉ ุชุทููุฑ
- โ Rollback scripts ุฌุงูุฒุฉ
- โ ุฎุทุฉ ุทูุงุฑุฆ

### โ๏ธ ุฎุทุฑ 2: ุงูุฃุฏุงุก
**ุงูุชุฎููู**:
- โ Indexes ููุงุณุจุฉ ุนูู showroom_id
- โ Pagination ููููุงุฆู ุงูุทูููุฉ
- โ Caching ููุฅุนุฏุงุฏุงุช
- โ Query optimization

### โ๏ธ ุฎุทุฑ 3: ุชุนููุฏ ุงูุตูุงุญูุงุช
**ุงูุชุฎููู**:
- โ Helpers ููุญุฏุฉ
- โ Decorators ูุงุถุญุฉ
- โ ุชูุซูู ุดุงูู
- โ Testing ููุซู

### โ๏ธ ุฎุทุฑ 4: ุชุฏุฑูุจ ุงููุณุชุฎุฏููู
**ุงูุชุฎููู**:
- โ ุฏููู ูุณุชุฎุฏู ูุตูุฑ
- โ ููุฏูููุงุช ุชุฏุฑูุจูุฉ
- โ ุฌูุณุงุช ุชุฏุฑูุจ
- โ ุฏุนู ููู

---

## ุงูุฌุฒุก ุงูุนุงุดุฑ: ููุฎุต ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ

### โจ ูุง ุงูุฌุฏูุฏ ูู ูุฐู ุงููุณุฎุฉุ

1. **ุงูุนููุงุก ูุดุชุฑููู**: 
   - โ ูุง ููุฌุฏ `showroom_id` ูู Customer
   - โ ูููู ุฑุคูุชูู ูู ุฌููุน ุงูุตุงูุงุช
   - โ ุงูุทูุจุงุช ููุท ูุฑุชุจุทุฉ ุจุงูุตุงูุฉ

2. **ุชุณุนูุฑ ูุญุณูู**:
   - โ ูุตู `cost_price` ู `purchase_price`
   - โ ุซูุงุซ ุณูุงุณุงุช ุชุณุนูุฑ
   - โ Audit trail ููุฃุณุนุงุฑ
   - โ ููู ุงูุฃุณุนุงุฑ ุงููุนุฏูุฉ ูุฏููุงู

3. **ููุฑุฏูู ูุญุณูููู**:
   - โ Computed properties ุจุฏู ุญููู ููุฑุฑุฉ
   - โ Soft delete ูุญูุงูุฉ ุงูุจูุงูุงุช
   - โ Validators ูููุน ุงูุจูุงูุงุช ุบูุฑ ุงูุตุญูุญุฉ
   - โ ุนูุงูุงุช ูุงุถุญุฉ

4. **ุตูุงุญูุงุช ุฏูููุฉ**:
   - โ Helpers ููุญุฏุฉ (`get_scoped_query`)
   - โ Decorators ููุญูุงูุฉ
   - โ ูุตูููุฉ ุตูุงุญูุงุช ูุงุถุญุฉ
   - โ ุนุฒู ุชุงู ุจูู ุงูุตุงูุงุช

5. **Audit ูุชุชุจุน**:
   - โ ูููุฐุฌ AuditLog ุดุงูู
   - โ ุชุณุฌูู ุชููุงุฆู ููุชุบููุฑุงุช ุงููููุฉ
   - โ ุชูุงุฑูุฑ ุงููุดุงุทุงุช
   - โ ูุญุงุณุจุฉ ููุฑุงุฌุนุฉ

6. **ุฅุนุฏุงุฏุงุช ูุฑูุฒูุฉ**:
   - โ SystemSettings model
   - โ ูุงุฌูุฉ ุฃุฏูุงุช ุงููุดุฑู
   - โ ุชุฎุตูุต ููู ุตุงูุฉ
   - โ Overrides ููุฃุตูุงู ุงููุฑุฏูุฉ

---

## ุงูุฃุณุฆูุฉ ุงููุชุจููุฉ ูููุณุชุฎุฏู

ูุจู ุงูุจุฏุก ูู ุงูุชูููุฐุ ูุญุชุงุฌ ูุฑุงุฑุงุชู ูู:

1. **ุฅุนุงุฏุฉ ุชุณููุฉ unit_price**:
   - ุงูุฎูุงุฑ A: ุฅุนุงุฏุฉ ุชุณููุฉ `unit_price` โ `cost_price` ูุน Migration
   - ุงูุฎูุงุฑ B: ุฅุถุงูุฉ `cost_price` ุฌุฏูุฏ ูุงูุฅุจูุงุก ุนูู `unit_price` ููุชูุงูู
   - **ุงูุชูุตูุฉ**: ุงูุฎูุงุฑ B

2. **Audit Log**:
   - ูู ูุทุจูู ูู ุงูุจุฏุงูุฉ ุฃู ูู ูุฑุญูุฉ ูุงุญูุฉุ
   - **ุงูุชูุตูุฉ**: ูู ุงูุจุฏุงูุฉ (ููู ููุฃุณุนุงุฑ)

3. **ุณูุงุณุฉ ุงูุชุณุนูุฑ ุงูุงูุชุฑุงุถูุฉ**:
   - ุฃู ุณูุงุณุฉ ุชูุถู ูุงูุชุฑุงุถูุ
   - **ุงูุชูุตูุฉ**: `purchase_price_default` (ุงูุฃุจุณุท)

4. **ุงูููุฑุฏูู**:
   - ูู ูู ุตุงูุฉ ููุง ููุฑุฏูู ูููุตูููุ ุฃู ููุฑุฏูู ูุดุชุฑูููุ
   - **ุงูุชูุตูุฉ**: ูููุตููู (ุนุฒู ูุงูู)

5. **ุงูููุช ุงููุชุงุญ**:
   - ูู ูุฏูู 7-8 ุฃุณุงุจูุน ููุชุทุจูู ุงููุงููุ
   - ุฃู ูุจุฏุฃ ุจู MVP (4 ุฃุณุงุจูุน) ุซู ูุถูู ุชุฏุฑูุฌูุงูุ
   - **ุงูุชูุตูุฉ**: MVP ุซู ุชูุณุน

---

## ุฌุงูุฒ ููุชูููุฐ! ๐

ุงูุฎุทุฉ ุงูุขู:
- โ ุดุงููุฉ ูููุตูุฉ
- โ ูุญูููุฉ ูู ุงูุชุนุงุฑุถุงุช
- โ ูุน ุชุญุณููุงุช ููุชุฑุญุฉ
- โ ูุน ุฎุทุฉ ุชูููุฐ ูุงุถุญุฉ
- โ ูุน ูุฑุงุนุงุฉ ุงููุฎุงุทุฑ

**ุงูุชุธุฑ ููุงููุชู ููุจุฏุก!** ๐ฏ

